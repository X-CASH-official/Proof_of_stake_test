#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "define_macro_functions.h"
#include "define_macros.h"

#include "blockchain_functions.h"

#include "define_macros_test.h"
#include "variables_test.h"
#include "blockchain_functions_test.h"

/*
-----------------------------------------------------------------------------------------------------------
Functions
-----------------------------------------------------------------------------------------------------------
*/

/*
-----------------------------------------------------------------------------------------------------------
Name: blockchain_test
Description: Test the blockchain_functions
Return: The number of passed blockchain test
-----------------------------------------------------------------------------------------------------------
*/

int blockchain_test()
{ 
  // define macros
  #define BLOCKCHAIN_TEST 5
  #define NETWORK_BLOCK "0d0da5d5f1e00500000000000000000000000000000000000000000000000000000000000000050000000002b5d9ab0101fff9d8ab0101b2cce199a30202b1ae08c48f3b3e9ba6e22d9fdaf289eda8565179ebff7787883ecaf49f1ebdfbf41801159a7ed6a1065b708355d900b06e4e1c47238397723f4d379945b3bcdf10f09702d0187c424c4f434b434841494e5f52455345525645445f42595445535f53544152547c64656c65676174656e616d65317c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c5843413176313851736635504b4c723847467231346a486b6a6766336d506d314d4156627377427339515037467747544c434534537759693831425270327672635631326d614d744377395445314e5a525679796e51336532633362376d785277337c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c307c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c64656c65676174655f6261636b75705f312c64656c65676174655f6261636b75705f322c64656c65676174655f6261636b75705f332c64656c65676174655f6261636b75705f342c64656c65676174655f6261636b75705f357c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c64656c65676174656e616d65327c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c58434131675463557337443761486f32756f533239474445706a4d576b52357a7a514a43337a78437742315231674d4c594263736d70414267575a394d5776764c57585633516868595a39376d63787356383854665a725032564d416d6152514a347c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c307c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c64656c65676174655f6261636b75705f312c64656c65676174655f6261636b75705f322c64656c65676174655f6261636b75705f332c64656c65676174655f6261636b75705f342c64656c65676174655f6261636b75705f357c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c64656c65676174656e616d65337c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c584341313036674d4a6a6e59706b4c70533768546f6544375443625531796464475263427a7173416b35425447327643776e4d7536504c5a6232385a36644543566853587038374d374865505369624c444b4777363433696a4b6e4d774c303536327c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c307c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c64656c65676174655f6261636b75705f312c64656c65676174655f6261636b75705f322c64656c65676174655f6261636b75705f332c64656c65676174655f6261636b75705f342c64656c65676174655f6261636b75705f357c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c7c73a5031d645004add8a0360f3a01302cd7e0a1125842e50b7deca371cf67237c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c7c73a5031d645004add8a0360f3a01302cd7e0a1125842e50b7deca371cf67237c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c5b951935c5066c51f1beef7295aba6856ef5a1c85a2ca14c98a4f8745626a1313a2efab73f452334f3c36aac626b4c12296b1d84925b61831ebeba96b464da6158455118474e7dbeb0234680fba587097c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c310f13ef35d48748ad7057fe55861912fc153221b10633ebdb79460db8dbaa5a2a82796702b2eeef6b3355ebcbb1b8f65a62837d9bb5f64383722ac20f308e5c7c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c747275657c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c05f1c69a16ac265377454395bd133c9072b59fa3e0cd652f6f8e8d55fbff19927c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c30303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303035363536676635676866696a64696f76644a4450494f53677a663534683477363532343567643573313032316430673635316466383467643531363531663635643467353836343136643566345a36643534673635643473363534673635346673646734357c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c7f78db0d006639548c88fa9685ba3d0fa64e626d426c37e28ad442f74cb80e39a5ed9b4fb397f01bfbc8f54dd8aea7590d0408ae433d4d111eaef0ed97b9074f608bbb1722abaafa8734616ce7e4350b7c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c414079410cb5ed29a0f331a79cbf898d62b1f94c4d4752d4b9519668ada04f2201a277d60f09f8e50a5e4b0342aafdbd718a0761da52f3f7d3f0a38cc8cb05737c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c747275657c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c7c73a5031d645004add8a0360f3a01302cd7e0a1125842e50b7deca371cf67237c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c30303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303035363536676635676866696a64696f76644a4450494f53677a663534683477363532343567643573313032316430673635316466383467643531363531663635643467353836343136643566345a36643534673635643473363534673635346673646734357c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477cf7b2033fae04e087bd39478c6e5795bbf4f68a51c79bb6d7c085f86770b57a59ef8e61441ac6f67efa6c5f8286a02922f3fa91fd0d74d036462cc9e9f53ee0f4c8e63375b2b48af034591ba864ee260d7c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c0162fc911133879a42732ae5dc6bec484e0a8ad77cba4a8b6af260c84f6c6e42af3d21caee35b78a8a89ea7d88efd877724fc6d493059f4824dd40e866f4941a7c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c747275657c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c747275657c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c00000000000000000000000000000000000000000000000000000000000000057c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057c424c4f434b434841494e5f444154415f5345474d454e545f535452494e477c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057c424c4f434b434841494e5f52455345525645445f42595445535f454e447c000500000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000005"
  #define NETWORK_BLOCK_HEIGHT "2813049"
  #define VARINT_ENCODED_VALUE_1 0xb2f58199a302 // random value
  #define VARINT_ENCODED_VALUE_TEXT_1 "b2f58199a302" // random value
  #define VARINT_DECODED_VALUE_1 78167177906 // random value
  #define VARINT_ENCODED_VALUE_2 0x7d // no encoding or decoding
  #define VARINT_ENCODED_VALUE_TEXT_2 "7d" // no encoding or decoding
  #define VARINT_DECODED_VALUE_2 125 // no encoding or decoding
  #define VARINT_ENCODED_VALUE_3 0x8002 // start of 1 byte length
  #define VARINT_ENCODED_VALUE_TEXT_3 "8002" // start of 1 byte length
  #define VARINT_DECODED_VALUE_3 256 // start of 1 byte length
  #define VARINT_ENCODED_VALUE_4 0xff7f // end of 1 byte length
  #define VARINT_ENCODED_VALUE_TEXT_4 "0xff7f" // end of 1 byte length
  #define VARINT_DECODED_VALUE_4 16383 // end of 1 byte length
  #define VARINT_ENCODED_VALUE_5 0x808001 // start of 2 byte length
  #define VARINT_ENCODED_VALUE_TEXT_5 "808001" // start of 2 byte length
  #define VARINT_DECODED_VALUE_5 16384 // start of 2 byte length
  #define VARINT_ENCODED_VALUE_6 0xffff7f // end of 2 byte length
  #define VARINT_ENCODED_VALUE_TEXT_6 "ffff7f" // end of 2 byte length
  #define VARINT_DECODED_VALUE_6 2097151 // end of 2 byte length
  #define VARINT_ENCODED_VALUE_7 0x80808001 // start of 3 byte length
  #define VARINT_ENCODED_VALUE_TEXT_7 "80808001" // start of 3 byte length
  #define VARINT_DECODED_VALUE_7 2097152 // start of 3 byte length
  #define VARINT_ENCODED_VALUE_8 0xffffff7f // end of 3 byte length
  #define VARINT_ENCODED_VALUE_TEXT_8 "ffffff7f" // end of 3 byte length
  #define VARINT_DECODED_VALUE_8 268435455 // end of 3 byte length
  #define VARINT_ENCODED_VALUE_9 0x8080808001 // start of 4 byte length
  #define VARINT_ENCODED_VALUE_TEXT_9 "8080808001" // start of 4 byte length
  #define VARINT_DECODED_VALUE_9 268435456 // start of 4 byte length
  #define VARINT_ENCODED_VALUE_10 0xffffffff7f // end of 4 byte length
  #define VARINT_ENCODED_VALUE_TEXT_10 "ffffffff7f" // end of 4 byte length
  #define VARINT_DECODED_VALUE_10 34359738367 // end of 4 byte length
  #define VARINT_ENCODED_VALUE_11 0x808080808001 // start of 5 byte length
  #define VARINT_ENCODED_VALUE_TEXT_11 "808080808001" // start of 5 byte length
  #define VARINT_DECODED_VALUE_11 34359738368 // start of 5 byte length
  #define VARINT_ENCODED_VALUE_12 0xffffffffff7f // end of 5 byte length
  #define VARINT_ENCODED_VALUE_TEXT_12 "ffffffffff7f" // end of 5 byte length
  #define VARINT_DECODED_VALUE_12 4398046511103 // end of 5 byte length
  #define VARINT_ENCODED_VALUE_13 0x80808080808001 // start of 6 byte length
  #define VARINT_ENCODED_VALUE_TEXT_13 "80808080808001" // start of 6 byte length
  #define VARINT_DECODED_VALUE_13 4398046511104 // start of 6 byte length
  #define VARINT_ENCODED_VALUE_14 0xffffffffffff7f // end of 6 byte length
  #define VARINT_ENCODED_VALUE_TEXT_14 "ffffffffffff7f" // end of 6 byte length
  #define VARINT_DECODED_VALUE_14 562949953421311 // end of 6 byte length
  #define VARINT_ENCODED_VALUE_15 0x8080808080808001 // start of 7 byte length
  #define VARINT_ENCODED_VALUE_TEXT_15 "8080808080808001" // start of 7 byte length
  #define VARINT_DECODED_VALUE_15 562949953421312 // start of 7 byte length
  #define VARINT_ENCODED_VALUE_16 0xffffffffffffff7f // end of 7 byte length
  #define VARINT_ENCODED_VALUE_TEXT_16 "ffffffffffffff7f" // end of 7 byte length
  #define VARINT_DECODED_VALUE_16 72057594037927935 // end of 7 byte length

  // reset the variables
  memset(data_test,0,strnlen(data_test,BUFFER_SIZE));
  count_test = 0;

  // write the start test message
  color_print(TEST_OUTLINE,"blue");
  printf("\033[1;34mvarint_decode test - Total test: %d\033[0m\n",BLOCKCHAIN_TEST);
  color_print(TEST_OUTLINE,"blue");
  printf("\n");

  // run the varint_decode test
  if (varint_decode(VARINT_ENCODED_VALUE_1) == VARINT_DECODED_VALUE_1 ||
      varint_decode(VARINT_ENCODED_VALUE_2) == VARINT_DECODED_VALUE_2 ||
      varint_decode(VARINT_ENCODED_VALUE_3) == VARINT_DECODED_VALUE_3 ||
      varint_decode(VARINT_ENCODED_VALUE_4) == VARINT_DECODED_VALUE_4 ||
      varint_decode(VARINT_ENCODED_VALUE_5) == VARINT_DECODED_VALUE_5 ||
      varint_decode(VARINT_ENCODED_VALUE_6) == VARINT_DECODED_VALUE_6 ||
      varint_decode(VARINT_ENCODED_VALUE_7) == VARINT_DECODED_VALUE_7 ||
      varint_decode(VARINT_ENCODED_VALUE_8) == VARINT_DECODED_VALUE_8 ||
      varint_decode(VARINT_ENCODED_VALUE_9) == VARINT_DECODED_VALUE_9 ||
      varint_decode(VARINT_ENCODED_VALUE_10) == VARINT_DECODED_VALUE_10 ||
      varint_decode(VARINT_ENCODED_VALUE_11) == VARINT_DECODED_VALUE_11 ||
      varint_decode(VARINT_ENCODED_VALUE_12) == VARINT_DECODED_VALUE_12 ||
      varint_decode(VARINT_ENCODED_VALUE_13) == VARINT_DECODED_VALUE_13 ||
      varint_decode(VARINT_ENCODED_VALUE_14) == VARINT_DECODED_VALUE_14 ||
      varint_decode(VARINT_ENCODED_VALUE_15) == VARINT_DECODED_VALUE_15 ||
      varint_decode(VARINT_ENCODED_VALUE_16) == VARINT_DECODED_VALUE_16)
  {
    color_print("PASSED! Test for varint decode","green");
    count_test++;
  }
  else
  {
    color_print("FAILED! Test for varint decode","red");
  }

  // run the varint_encode test
  if ((varint_encode(VARINT_DECODED_VALUE_1,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_1,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_2,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_2,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_3,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_3,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_4,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_4,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_5,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_5,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_6,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_6,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_7,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_7,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_8,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_8,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_9,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_9,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_10,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_10,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_11,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_11,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_12,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_12,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_13,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_13,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_14,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_14,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_15,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_15,BUFFER_SIZE) == 0) ||
      (varint_encode(VARINT_DECODED_VALUE_16,data_test) == 1 && strncmp(data_test,VARINT_ENCODED_VALUE_TEXT_16,BUFFER_SIZE) == 0))
  {
    color_print("PASSED! Test for varint encode","green");
    count_test++;
  }
  else
  {
    color_print("FAILED! Test for varint encode","red");
  }

  // run the network_block_string_to_blockchain_data test
  if (network_block_string_to_blockchain_data(NETWORK_BLOCK,NETWORK_BLOCK_HEIGHT) == 1)
  {
    color_print("PASSED! Test for converting a network_block_string to a blockchain_data struct","green");
    count_test++;
  }
  else
  {
    color_print("FAILED! Test for converting a network_block_string to a blockchain_data struct","red");
  }

  // verify the blockchain_data
  if (verify_network_block_data(0,0,0,NETWORK_BLOCK_HEIGHT) == 1)
  {
    color_print("PASSED! Test for verifying the blockchain_data struct","green");
    count_test++;
  }
  else
  {
    color_print("FAILED! Test for verifying the blockchain_data struct","red");
  }

  // run the blockchain_data_to_network_block_string test and verify the network_block_string
  if (blockchain_data_to_network_block_string(data_test) == 1)
  {
    // verify the network_block_string
    if (strncmp(NETWORK_BLOCK,data_test,BUFFER_SIZE) == 0)
    {
      color_print("PASSED! Test for converting a blockchain_data struct to a network_block_string","green");
      count_test++;
    }
    else
    {
      color_print("FAILED! Test for converting a blockchain_data struct to a network_block_string","red");
    }
  }
  else
  {
    color_print("FAILED! Test for converting a blockchain_data struct to a network_block_string","red");
  }



  // write the end test message
  if (count_test == BLOCKCHAIN_TEST)
  {
    printf("\n");
    color_print(TEST_OUTLINE,"green");
    printf("\033[1;32mvarint_decode test - Passed test: %d, Failed test: 0\033[0m\n",BLOCKCHAIN_TEST);
    color_print(TEST_OUTLINE,"green");
    printf("\n\n");
  }
  else
  {
    printf("\n");
    color_print(TEST_OUTLINE,"red");
    printf("\033[1;31mvarint_decode test - Passed test: %d, Failed test: %d\033[0m\n",count_test,BLOCKCHAIN_TEST-count_test);
    color_print(TEST_OUTLINE,"red");
    printf("\n\n");
  } 
  return count_test;

  #undef BLOCKCHAIN_TEST
  #undef NETWORK_BLOCK
  #undef VARINT_ENCODED_VALUE_1
  #undef VARINT_ENCODED_VALUE_TEXT_1
  #undef VARINT_DECODED_VALUE_1
  #undef VARINT_ENCODED_VALUE_2
  #undef VARINT_ENCODED_VALUE_TEXT_2
  #undef VARINT_DECODED_VALUE_2
  #undef VARINT_ENCODED_VALUE_3
  #undef VARINT_ENCODED_VALUE_TEXT_3
  #undef VARINT_DECODED_VALUE_3
  #undef VARINT_ENCODED_VALUE_4
  #undef VARINT_ENCODED_VALUE_TEXT_4
  #undef VARINT_DECODED_VALUE_4
  #undef VARINT_ENCODED_VALUE_5
  #undef VARINT_ENCODED_VALUE_TEXT_5
  #undef VARINT_DECODED_VALUE_5
  #undef VARINT_ENCODED_VALUE_6
  #undef VARINT_ENCODED_VALUE_TEXT_6
  #undef VARINT_DECODED_VALUE_6
  #undef VARINT_ENCODED_VALUE_7
  #undef VARINT_ENCODED_VALUE_TEXT_7
  #undef VARINT_DECODED_VALUE_7
  #undef VARINT_ENCODED_VALUE_8
  #undef VARINT_ENCODED_VALUE_TEXT_8
  #undef VARINT_DECODED_VALUE_8
  #undef VARINT_ENCODED_VALUE_9
  #undef VARINT_ENCODED_VALUE_TEXT_9
  #undef VARINT_DECODED_VALUE_9
  #undef VARINT_ENCODED_VALUE_10
  #undef VARINT_ENCODED_VALUE_TEXT_10
  #undef VARINT_DECODED_VALUE_10
  #undef VARINT_ENCODED_VALUE_11
  #undef VARINT_ENCODED_VALUE_TEXT_11
  #undef VARINT_DECODED_VALUE_11
  #undef VARINT_ENCODED_VALUE_12
  #undef VARINT_ENCODED_VALUE_TEXT_12
  #undef VARINT_DECODED_VALUE_12
  #undef VARINT_ENCODED_VALUE_13
  #undef VARINT_ENCODED_VALUE_TEXT_13
  #undef VARINT_DECODED_VALUE_13
  #undef VARINT_ENCODED_VALUE_14
  #undef VARINT_ENCODED_VALUE_TEXT_14
  #undef VARINT_DECODED_VALUE_14
  #undef VARINT_ENCODED_VALUE_15
  #undef VARINT_ENCODED_VALUE_TEXT_15
  #undef VARINT_DECODED_VALUE_15
  #undef VARINT_ENCODED_VALUE_16
  #undef VARINT_ENCODED_VALUE_TEXT_16
  #undef VARINT_DECODED_VALUE_16
}